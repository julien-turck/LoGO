
{% extends 'operation/base.html' %}
{% load static %}

{% block title %}
    Liste des op√©rations
{% endblock %}

{% block content %}
    <h2>Liste des op√©rations</h2>

    <a href="{% url 'ajouter_operation' %}">Ajouter une op√©ration</a>

    <table id="table-operations" class="display">
        <thead>
            <tr>
                <th>Titre</th>
                <th class="lier-colonne" style="display: none;">Lier op√©ration</th>
                <th>Type</th>
                <th>Date</th>
                <th>Statut</th>
                <th>Collectivit√©</th>
            </tr>
        </thead>
        <tbody>
            {% for op in operations %}
                {% if operation_cible_id != op.id|stringformat:"s" %}
                    <tr>
                        <td><a href="{% url 'afficher_operation' op.id %}">{{ op.titre }}</a></td>
                        <td class="lier-colonne" style="display: none;">
                            {% if operation_cible_id and not op.est_liee %}
                                <a href="{% url 'lier_operation' operation_cible_id op.id %}" style="padding: 8px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 4px;">
                                    üîó Lier cette op√©ration
                                </a>
                            {% else %}
                                <span class="text-muted">D√©j√† li√©e</span>
                            {% endif %}
                        </td>
                        <td>{{ op.type_operation }}</td>
                        <td>{{ op.date }}</td>
                        <td>{{ op.get_statut_display }}</td>
                        <td>{{ op.collectivite.nom }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
{% endblock %}


{% block scripts %}
<script>
    $(document).ready(function() {
        $('#table-operations').DataTable({
            language: {
                search: "Rechercher :",
                lengthMenu: "Afficher _MENU_ √©l√©ments",
                info: "Affichage de l'√©l√©ment _START_ √† _END_ sur _TOTAL_ √©l√©ments",
                infoEmpty: "Affichage de l'√©l√©ment 0 √† 0 sur 0 √©l√©ment",
                infoFiltered: "(filtr√© de _MAX_ √©l√©ments au total)",
                zeroRecords: "Aucun √©l√©ment √† afficher",
                emptyTable: "Aucune donn√©e disponible dans le tableau",
                paginate: {
                    first: "Premier",
                    previous: "Pr√©c√©dent",
                    next: "Suivant",
                    last: "Dernier"
                }
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const params = new URLSearchParams(window.location.search);
        if (params.has("lier_a")) {
        const colonnes = document.querySelectorAll(".lier-colonne");
        colonnes.forEach(col => col.style.display = "table-cell");
        }
    });
</script>
{% endblock %}

